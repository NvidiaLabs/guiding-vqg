import argparse
import json
import random
from pprint import pprint


chosen_ids = ['338159', '261273', '67131', '579655', '89359', '553549', '404781', '171349', '129186', '439902', '192788', '356733', '25551', '306313', '152000', '172850', '152648', '39900', '20935', '468935', '373662', '573134', '125524', '361804', '62706', '330880', '15690', '551052', '103127', '170595', '361830', '411530', '147293', '127626', '521967', '128939', '257471', '350607', '476109', '211108', '47648', '192817', '499266', '390583', '97656', '451155', '476773', '357096', '519565', '178683', '577091', '116861', '548561', '357824', '467887', '547212', '419624', '386032', '271588', '26323', '430529', '343481', '516804', '420181', '351130', '264180', '468784', '23489', '128460', '293611', '147205', '573181', '370233', '435937', '370697', '10142', '233305', '91779', '343972', '572734', '544629', '65567', '464682', '419453', '498940', '68291', '358055', '66635', '300413', '577169', '488154', '198492', '19451', '45564', '278175', '78748', '451412', '59463', '352334', '275898', '573008', '79392', '341778', '512166', '352491', '534784', '245274', '249658', '515911', '91545', '91110', '250313', '534983', '515540', '293832', '149197', '356387', '256906', '433883', '488206', '538054', '573750', '263723', '124004', '484674', '169757', '553721', '173274', '73622', '375450', '519635', '61564', '543531', '201934', '391560', '365711', '419119', '211891', '3084', '24285', '39053', '381842', '264718', '431897', '47752', '567308', '407825', '379552', '213579', '482597', '420156', '239010', '399384', '387470', '127920', '107105', '192871', '492025', '578675', '42622', '391915', '281601', '81303', '320324', '150576', '501172', '124803', '93393', '497187', '376342', '407072', '159662', '384528', '246809', '83364', '518605', '197716', '455608', '450202', '254119', '291588', '479556', '225405', '566414', '215650', '424289', '72714', '576704', '236604', '441440', '467116', '231125', '469085', '291833', '141278', '173400', '576754', '412184', '410735', '548223', '251317', '153061', '390902', '515785', '285007', '13789', '198650', '323561', '250246', '532690', '515391', '284379', '529850', '411958', '573033', '403792', '252639', '181714', '564612', '142261', '27519', '205206', '548219', '334513', '184324', '530337', '290196', '498381', '86467', '341828', '296426', '412978', '236516', '385236', '28156', '351621', '128528', '238573', '87864', '423204', '321476', '383594', '220221', '66798', '223426', '241155', '465272', '119640', '297819', '232315', '229553', '127990', '350988', '523292', '262896', '397354', '293425', '26611', '55780', '119038', '440528', '73014', '521717', '415163', '225784', '460931', '417849', '42979', '26982', '19176', '576363', '230915', '353398', '115765', '501260', '236845', '26735', '482667', '46428', '232597', '103806', '500784', '336961', '266627', '424940', '433423', '56891', '457754', '117036', '164512', '350639', '368302', '412036', '447089', '574316', '244111', '107548', '279887', '235000', '458175', '421811', '543740', '12326', '146150', '507143', '440023', '82085', '496768', '394841', '217329', '398682', '313599', '400950', '190041', '63882', '154193', '80834', '329932', '115626', '62839', '121152', '21396', '364307', '32944', '339738', '455624', '431479', '284153', '263163', '178078', '23294', '530099', '140651', '196815', '248488', '194216', '263758', '465795', '406182', '367082', '394033', '379378', '428105', '152004', '295656', '221282', '208132', '365129', '125017', '547487', '357044', '461821', '356622', '259465', '25984', '415723', '252559', '527828', '576200', '486008', '1369', '479858', '81766', '396295', '275034', '478099', '140076', '567863', '149251', '494273', '151141', '275175', '23623', '102908', '1171', '485951', '53145', '260478', '471009', '71815', '74331', '132510', '138806', '277543', '240455', '311887', '55868', '463669', '431996', '6497', '183889', '404820', '507887', '534554', '179114', '505939', '255582', '168512', '504125', '341048', '53139']


def get_image_samples(model_outputs, k=400):
    l = list(model_outputs.items())
    random.shuffle(l)
    model_outputs = dict(l)
    chosen_samples = {}
    for image_id, data_list, in model_outputs.items():
        if len(chosen_samples) > k:
            break
        image_id = str(image_id)
        if image_id in chosen_ids:
            for data_obj in data_list:
                if data_obj["generated_q"] != data_obj["real_q"]:
                    chosen_samples[image_id] = data_obj
                    break
    print(chosen_samples)
    print(chosen_samples.keys())
    return chosen_samples

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--model_outputs", type=str, default="model_outputs.json")
    parser.add_argument("--chosen_samples_dump", type=str, default="chosen_samples.json")
    args = parser.parse_args()
    model_outputs = json.load(open(args.model_outputs, "r"))
    # model_outputs = {1: [{category: "", objects: "", generated_q: "", real_q: ""}, {}], 2: [], 3: []}
    chosen_samples = get_image_samples(model_outputs)
    json.dump(chosen_samples, open(args.chosen_samples_dump, "w"))